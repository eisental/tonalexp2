{"version":3,"sources":["ui.js","spreadsheet_io.js","sessions.js","texts.js","login.js","ExperimentUI.js","audio_mapping.js","randomize.js","audio_controller.js","FirstExperimentBlock.js","FirstExperiment.js","SecondExperiment.js","App.js","serviceWorker.js","index.js"],"names":["openFullscreen","elem","document","documentElement","requestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","msRequestFullscreen","LoadingScreen","className","ErrorScreen","error","InfoScreen","info","next","continue_disabled","disabled","Button","label","onClick","type","ContinueButton","ComboBox","id","options","keypress_event","prevent_keypress","e","preventDefault","name","defaultValue","value","map","opt","key","onKeyDown","read_url","parse_sheet_list","data","sheetNames","sheets","forEach","sheet","push","properties","title","gs","read","conn","sheetName","range","fetch","spreadsheet_id","api_key","write","Array","isArray","url","write_url","headers","method","mode","body","JSON","stringify","list_sheets","then","res","json","SheetNames","SessionEvent","parseSessions","sessions","values","session_event","session","number","event","time","writeSessionEvent","on_error","request_data","Object","assign","Date","toString","catch","does_user_sheet_exists","user_id","includes","login_text","questions_text","first_question","ordered_questions","xy_question","taste_question","intro_texts","Fragment","first_experiment_intro","first_experiment_training_info","first_experiment_training_end","first_experiment_pause","second_experiment_intro","second_experiment_question","second_experiment_hear_again","second_experiment_pause","zero2hundred_options","keys","i","one2hundred_options","LoginScreen","hidden","getElementById","FormScreen","React","useState","setError","error_div","size","age","genderMaleChecked","checked","genderFemaleChecked","gender","musical_performance_years","musical_theory_years","absoluteYesChecked","absoluteNoChecked","absolute_hearing","musicianYesChecked","musicianNoChecked","is_musician","native_language","musical_activity","headphones","computer","additional_devices","location_details","trim","numbered_options","taste_options","XYselection","width","height","onUpdate","draw_axes","props","ctx","fillStyle","lineWidth","strokeRect","c_x","c_y","beginPath","moveTo","lineTo","closePath","stroke","canvas_click","rect","canvasRef","current","getBoundingClientRect","px","clientX","left","py","clientY","top","x","y","clearRect","arc","Math","PI","fill","cancel_update","prev_px","prev_py","confirmAlert","message","buttons","onClickOutside","closeOnEscape","createRef","this","getContext","ref","Component","FirstExperimentTrialUI","replay","trial_data","question_order","disable_buttons","disable_questions","emotion_value","setEmotion","energy_value","setEnergy","htmlFor","first_answer","ordered_answers","length","answer","taste_answer","console","log","question_1","question_2","question_3","question_4","question_5","emotion","energy","taste","SecondExperimentTrialUI","disable_question","musical_question","Instrument","music_key_to_idx","instrument_dir","trial_audio","pause_audio_paths","base_audio_dir","trial_audio_paths","instrument","n","randomElement","arr","min","max","floor","random","shuffleArray","a","sort","b","AudioController","srcs","onDoneLoading","onAudioEnded","players","ids2players","players2ids","playerIdx","p","Audio","addEventListener","audioLoaded","onerror","code","loadCount","player","audio_id","play","err","pause","currentTime","FirstExperimentBlock","audio_controller","trial_num","ls_prefix","state","trial_idx","on_pause","is_playing","play_count","nextTrial","setState","start_time","getTime","playTrial","trial_sequence","startPause","trials","RT","ls","set","pause_path","pause_sequence","pause_audio","enable_pause_continue","cont_trial_seq","get","all_audio","cur_instrument","first_audio","first_key","second_audio","rest_audio","filter","concat","td","experiment_number","trial_number","audio","IntroScreen","done_playing","second_part","FirstExperiment","steps","INTRO","TRAINING_INFO","TRAINING","EXPERIMENT_INFO","EXPERIMENT_BLOCK","step","is_loading","disable_intro_buttons","nextStep","new_step","playTraining","playIntro","intro_audio","training_audio","audio_srcs","cont_step","done_playing_intro","SecondExperiment","num_trials","show_info","startTrials","first_trial_data","sequence","cont_seq","piano_trials","strings_trials","audio_files","t","FinishScreen","done_saving","FeedbackScreen","rows","cols","experience_question","dialog_question","App","LOGIN","FORM","EXPERIMENT1","EXPERIMENT2","FEEDBACK","FINISH","loading","setStep","stepWillChange","handleLogin","session_number","altered_step","stepChanged","end_time","that","dataSaveError","check_for_subject_sheet","sheet_exists","found_sheet","subject_id","response","row","first_instrument","subject_data","sinst","toLowerCase","undefined","readSessionData","previous_sessions","startNewSession","last_session","last_session_number","parseInt","continueSession","clear","cont_data","alert","Boolean","window","location","hostname","match","ReactDOM","render","StrictMode","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.d41cf2cd.chunk.js","sourcesContent":["import React from 'react';\n\nexport const openFullscreen = () => {\n  const elem = document.documentElement;\n  if (elem.requestFullscreen) {\n    elem.requestFullscreen();\n  } else if (elem.mozRequestFullScreen) { /* Firefox */\n    elem.mozRequestFullScreen();\n  } else if (elem.webkitRequestFullscreen) { /* Chrome, Safari and Opera */\n    elem.webkitRequestFullscreen();\n  } else if (elem.msRequestFullscreen) { /* IE/Edge */\n    elem.msRequestFullscreen();\n  }\n};\n\nexport const LoadingScreen = () => {\n  return <div className=\"containter text-center\"><p className=\"lead\">טוען...</p></div>;\n};\n\nexport const ErrorScreen = ({error}) => {\n  return (\n    <div className=\"container\">\n      <div className=\"row\">\n        <div className=\"col-sm\">\n          <p>התרחשה שגיאה:</p>\n          <p className=\"lead center\">{error}</p>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport const InfoScreen = ({info, next, continue_disabled}) => {\n  return (\n    <div className=\"container\">\n      <div className=\"row\">\n        <div className=\"col-md-8 offset-md-2 infotext\">\n          {info}\n        </div>\n      </div>\n      <div className=\"row\">\n        <div className=\"col\"></div>\n        <div className=\"col text-center\">\n          <br/>\n          <ContinueButton next={next} disabled={continue_disabled} />\n        </div>\n        <div className=\"col\"></div>\n      </div>\n    </div>\n  );\n};\n\nexport const Button = ({label, onClick, disabled}) => {\n  return disabled ? \n    <button type=\"button\" className=\"btn btn-primary\" onClick={onClick} disabled>{label}</button> :\n    <button type=\"button\" className=\"btn btn-primary\" onClick={onClick}>{label}</button>;\n};\n\nexport const ContinueButton = ({next, label, disabled}) => {\n  return <Button label={label || \"המשך\"} onClick={next} disabled={disabled}/>;\n};\n\n/* 4 buttons in a square layout with fixation point in the middle. Each button is assigned a value to be passed to \n   the next function when it's clicked. */\nexport const ButtonTable = ({labels, values, disabled, next}) => {\n  const gen_button = (btn_idx) => {\n    if (disabled) \n      return <button className=\"chordBtn\" disabled onClick={(e) => next(values[btn_idx])}>{labels[btn_idx]}</button>;\n    else \n      return <button className=\"chordBtn\" onClick={(e) => next(values[btn_idx])}>{labels[btn_idx]}</button>;\n  };\n\n  return (\n    <table className=\"chordSelection\">\n      <tbody>\n        <tr>\n          <td>{gen_button(0)}</td>\n          <td></td>\n          <td>{gen_button(1)}</td>\n        </tr>\n        <tr>\n          <td></td>\n          <td className=\"plusSign align-middle\">+</td>\n          <td></td>\n        </tr>\n        <tr>\n          <td>{gen_button(2)}</td>\n          <td></td>\n          <td>{gen_button(3)}</td>\n        </tr>\n      </tbody>\n    </table>   \n  );\n};\n\nexport const ComboBox = ({id, options, disabled, prevent_keypress}) => {\n  const keypress_event = prevent_keypress ?\n        (e => {e.preventDefault(); return false; }) : null;\n\n  if (disabled) {\n    return (\n      <select id={id} name={id} defaultValue=\"\" disabled>\n        <option disabled value=\"\"></option>\n        {options.map(opt => <option value={opt} key={opt}>{opt}</option>)}\n      </select>\n    );\n  }\n  else {\n    return (\n      <select id={id} name={id} defaultValue=\"\" onKeyDown={keypress_event}>\n        <option disabled value=\"\"></option>\n        {options.map(opt => <option value={opt} key={opt}>{opt}</option>)}\n      </select>\n    );\n  }\n};\n","/* functions for reading and writing to a google spreadsheet.\n   \n */\n\nconst read_url = \"https://sheets.googleapis.com/v4/spreadsheets/\";\n\n// https://stackoverflow.com/questions/1714786/query-string-encoding-of-a-javascript-object\nexport const serialize = function(obj, prefix) {\n  var str = [],\n    p;\n  for (p in obj) {\n    if (obj.hasOwnProperty(p)) {\n      var k = prefix ? prefix + \"[\" + p + \"]\" : p,\n        v = obj[p];\n      str.push((v !== null && typeof v === \"object\") ?\n        serialize(v, k) :\n        encodeURIComponent(k) + \"=\" + encodeURIComponent(v));\n    }\n  }\n  console.log(\"serialize: \" + str.join(\"&\"));\n  return str.join(\"&\");\n}\n\nconst parse_sheet_list = (data) => {\n  let sheetNames = [];\n  data.sheets.forEach(sheet => {\n    sheetNames.push(sheet.properties.title);\n  });\n  return sheetNames;\n};\n\nconst gs = {\n  read: function(conn, sheetName, range) {\n    return fetch(read_url + \n                 conn.spreadsheet_id + \n                 \"/values/\" + \n                 sheetName + \n                 \"!\" + range + \n                 \"?key=\" + conn.api_key);\n  },\n\n  write: function(conn, sheetName, data) {\n    if (!Array.isArray(data))\n        data = [data];\n    let url = conn.write_url + \"?sheet_name=\" + sheetName;\n    return fetch(url,\n                 {\n                   headers: {\n                     'Accept': 'application/json',\n                     'Content-Type': 'application/json'\n                   },\n                   method: \"POST\",\n                   mode: 'no-cors',\n                   body: JSON.stringify(data),\n                 });\n  },\n\n  list_sheets: function(conn) {\n    return fetch(read_url + conn.spreadsheet_id + \"?key=\" + conn.api_key)\n      .then(res => res.json())\n      .then(parse_sheet_list);\n  },\n};\n\nexport default gs;\n","import gs from './spreadsheet_io.js';\n\nconst SheetNames = {\n  SESSIONS: \"Sessions\",\n  SUBJECTS: \"Subjects\",\n}\n\nexport const SessionEvent = {\n  SESSION_START: \"SESSION_START\",\n  SESSION_CONTINUED: \"SESSION_CONTINUED\",\n  SESSION_END: \"SESSION_END\",\n};\n\n// parse session json data from sheets api into an array of session objects.\nexport const parseSessions = (data) => {\n  let sessions = [];\n  data.values.forEach(session_event => {\n    let session = {\n      id: session_event[0],\n      number: session_event[1],\n      event: session_event[2],\n      time: session_event[3],\n    };\n    sessions.push(session);\n  });\n  return sessions;\n};\n\nexport const writeSessionEvent = (conn, session, event, on_error) => {\n  let request_data = Object.assign({event: event,\n                                    time: new Date().toString()},\n                                    session);\n  gs.write(conn, SheetNames.SESSIONS, request_data)\n    .catch(on_error);\n\n};\n\nexport const readSessionData = (conn) => {\n  return gs.read(conn, SheetNames.SESSIONS, \"A2:E10000\")\n    .then(response => response.json())\n    .then(parseSessions);\n  \n};\n\nexport const does_user_sheet_exists = (conn, user_id) => {\n  return gs.list_sheets(conn)\n    .then(sheets => sheets.includes(user_id));\n};\n\nexport const read_subject_data = (conn, subject_id) => {\n  return gs.read(conn, SheetNames.SUBJECTS, \"A2:C10000\")\n    .then(response => response.json())\n    .then(data => {\n      for (const row of data.values) {\n        if (row.length !== 3)\n          continue;\n\n        if (row[0] === subject_id) {\n          const subject_data = {\n            id: row[0],\n            first_instrument: row[1],\n            first_key: row[2],\n          }\n          return subject_data;\n        }\n      }\n      return null;\n    });\n}\n","import React from 'react';\n\nexport const login_text = (\n  <p>שלום, תודה שהסכמת להשתתף בניסוי.</p>\n);\n\nexport const questions_text = {\n  first_question: (\n    <p>\n      באיזו מידה הדובר השני (המיוצג על ידי שני הצלילים המסיימים) מסכים עם דבריו של הדובר הראשון (המיוצג ע\"י האקורדים החוזרים)?\n      <br/>\n      בחרו בין האפשרויות: 9 - מסכים לחלוטין; 1 - מתנגד לחלוטין (ניתן להשתמש בכל דרגות הביניים).\n    </p>\n  ),\n\n  ordered_questions: [\n    <p>באיזו מידה בוטח הדובר השני בדובר הראשון (9 - בוטח מאד; 1 - לא בוטח בו כלל)?</p>,\n    <p>באיזו מידה חש הדובר השני מתח למשמע דבריו של הדובר הראשון (9 - במידה רבה מאד; 1 - כלל לא)?</p>,\n    <p>באיזו מידה כועס הדובר השני על הדובר הראשון (9 - כועס מאד; 1 - לא כועס כלל)?</p>,\n    <p>\n      באיזו מידה חש הדובר השני שהוא מעל או מתחת לדובר הראשון בהיררכיה חברתית (יותר חשוב או נחשב ממנו)?\n      <br/>\n      אם הדובר השני הרבה מעל לראשון בהיררכיה (הרבה יותר חשוב ממנו) - סמנו 9; הרבה מתחתיו - סמנו 1.\n    </p>\n  ],\n\n  xy_question: (\n    <p>\n      בריבוע לפניך מתאר הציר האופקי (X) באיזו מידה רגשותיו של הדובר השני חיוביים (ימין) או שליליים (שמאל).\n     הציר האנכי (Y) מתאר באיזו רמה הדובר השני מלא אנרגיה (למעלה) או חסר אנרגיה (למטה).\n     ציין את מצבו הרגשי של הדובר השני ביחס לשני צירים אלו על ידי סימון נקודה (על ידי click) במיקום המתאים בריבוע.\n    </p>\n  ),\n\n  taste_question: <p>איזה טעם עולה בפי הדובר השני? בחר מהרשימה.</p>\n};\n\nexport const intro_texts = [(\n  <React.Fragment>\n    <p>שלום, ותודה שהסכמתם להשתתף בניסוי.</p>\n    <p>ניסוי זה ייערך בשני מפגשים, כשהמפגש השני ייערך בין יומיים לשבוע לאחר הראשון ולא מעבר לכך. יש להתחיל כל אחד משני המפגשים רק לאחר יצירת קשר עם הנסיינ/ית וקבלת אישור ממנה. ביצוע הניסוי ללא אישור הנסיינ/ית יגרום לפסילתו. את מועד המפגש השני יש לתאם מראש עם הנסיינ/ית, וכאמור, להתחיל רק לאחר קבלת אישור.</p>\n    <p>בתחילת הניסוי תבצעו שלב תרגול מקוון דרך זום, על ידי כך שתשתפו את מסך הניסוי עם הנסיין/ית. שיתוף המסך יעשה על ידכם (הנבדקים). לאחר שלב התרגול ינותק הקשר המקוון, אך הנסיינ/ית תהייה זמינה לפניותיכם במידה ותתעורר בעיה. אנא דווחו לנסיינ/ית על סיום הניסוי.</p>\n    <p>לפני תחילת הניסוי, אנא וודאו שעומדים לרשותכם חלל שקט שבו תוכלו להשאר כשעה ללא הפרעה. אנא השקיטו הודעות, התראות ושיחות בטלפון הסלולרי ובמחשב עד סיום הניסוי (do not disturb).</p>\n    <p>יש לבצע את הניסוי בעזרת מחשב נייח או נייד (לא בעזרת טלפון או טאבלט), בתצוגת מסך מלא (fullscreen). בניסוי עליכם לשבת מול מסך המחשב ולהשתמש באזניות המחוברות למחשב (השתמשו באזניות המפיקות איכות צליל סבירה לפחות). במהלך התרגול וודאו שהצלילים מגיעים אליכם בבירור, בעצמה נוחה (לא חלשה מאד, אך גם לא חזקה במידה שתעורר בכם אי נוחות), וללא רעשי לוואי או הפרעות אחרות. לאחר שקבעתם את העצמה הנוחה לכם, אל תשנו אותה עד לסיום הניסוי. סמנו לעצמכם איך כוון מד העצמה, כדי שתוכלו לכוונו לעוצמה זהה במפגש השני.</p>\n    <p>במהלך הניסוי תוכלו לקחת הפסקות קצרות במידת הצורך, אך יש לבצע כל אחד משני המפגשים ברצף, ולא לפצלו. במהלך הפסקה (אם נלקחה) השאירו את הניסוי פתוח.</p>\n    <p>משך מכסימלי של המפגש הנוכחי - 60 דקות. אין צורך למהר - משך זה מאפשר התנהלות נינוחה וקשובה, האזנות חוזרות, והפסקות קצרות, במידה ותזדקקו להן.</p>\n  </React.Fragment>\n), (\n  <React.Fragment>\n    <p>שלום - ברוכים הבאים למפגש השני של הניסוי.</p>\n    <p>מפגש זה יש לבצע במועד שתואם מראש עם הנסיינ/ית ורק לאחר קבלת אישור ממנה.</p>\n    <p>משך מכסימלי של המפגש הנוכחי - 90 דקות. אין צורך למהר - משך זה מאפשר התנהלות נינוחה וקשובה, האזנות חוזרות, והפסקות קצרות, במידה ותזדקקו להן.</p>\n  </React.Fragment>\n)];\n\nexport const first_experiment_intro = [\n  (\n    <React.Fragment>\n      <p>ניסוי זה הוא מעין תרגיל ב\"דמיון מודרך\" בעזרת מוזיקה.</p>\n      <p>בכל צעד בניסוי תשמעו קטע מוזיקאלי קצר ותתבקשו לענות על כמה שאלות אודותיו, כשאתם מדמים שהקטע הוא דיאלוג בין שני \"דוברים\".</p>\n      <p>לכל אחד מן הקטעים שתשמעו שני חלקים: בחלק הראשון כמה אקורדים (אקורד - כמה צלילים המושמעים יחד), ובחלק השני - שני צלילים בודדים. דמו ששני חלקים אלו הם שני ה\"דוברים\" בדיאלוג:</p>\n      <p>הדובר הראשון (סדרת האקורדים) מצהיר או טוען דבר מה, והדובר השני (שני הצלילים המסיימים) מגיב על דבריו.</p>\n      <p>לשמיעת דוגמה של \"דיאלוג\" כזה, לחצו \"נסה\".</p>\n    </React.Fragment>\n  ),\n  (\n    <React.Fragment>\n      <p>האם זיהיתם בבירור את שני הדוברים בדיאלוג?</p>\n      <p>אם אינכם בטוחים בזיהוי, לחצו שוב. אם זיהיתם, לחצו \"המשך\" למעבר למסך הבא.</p>\n    </React.Fragment>\n  )\n];\n\nexport const first_experiment_training_info = (\n  <React.Fragment>\n    <p>הקטע הראשון שתשמעו מיועד לתרגול.</p>\n    <p>בתרגול יוצגו לכם השאלות שישאלו בניסוי, ותוכלו לפנות לנסיין אם משהו אינו ברור.</p>\n    <p>לאחר תום התרגול יתנתק הנסיין (תוכלו ליצור אתו קשר במידה ותתעורר בעיה).</p>\n    <p>כל השאלות שתישאלו מתייחסות לדובר השני בדיאלוג (המיוצג על ידי שני הצלילים המסיימים) - לתגובתו לדובר הראשון, לרגשותיו כלפיו, או למאפיינים שונים שלו. אף שאין לשאלות אלו תשובות \"נכונות\" או \"שגויות\" אובייקטיבית, נסו לדייק סובייקטיבית בתשובה - לבחור בתשובה המייצגת באופן המדויק ביותר את מה <strong>שמרגיש</strong> לכם \"נכון\" עבור הקטע ששמעתם.</p>\n    <p>נסו לענות אינטואיטיבית, \"מהבטן\", ולא לנתח (במיוחד אם יש לכם השכלה מוזיקאלית!).</p>\n    <p>אם אינכם בטוחים, ואם הקטע פג מזכרונכם לפני שעניתם על כל השאלות, לחצו על כפתור \"השמע שוב\" שבתחתית המסך (מומלץ לענות כשהקטע טרי בזכרון).</p>\n    <p>בהאזנה ראשונה לכל קטע אנו ממליצים לעצום עיניים ולדמות את שני \"הדוברים\".</p>\n    <p>לחצו \"המשך\" למעבר לתרגול.</p>\n  </React.Fragment>\n);\n\nexport const first_experiment_training_end = (\n  <React.Fragment>\n    <p>שלב התרגול נגמר. אם ישנן שאלות - אנא שאלו אותן כעת.</p>\n    <p>כעת יש להתנתק מהזום ולהמשיך לעבוד על הניסוי באופן עצמאי. במקרה שיש שאלות יש ליצור קשר עם הנסיין/ית כפי שיסוכם כעת.</p>\n    <br/>\n    <p>אנא לחצו על כפתור ״המשך״ ברגע שהנסיין התנתק וסגרתם את הזום.</p>\n  </React.Fragment>\n);\n\nexport const first_experiment_pause = (\n  <React.Fragment>\n    <p>הפסקה קצרה: אנא הישארו במקומכם והקשיבו למוזיקה באמצעות האוזניות.</p>\n    <br/>\n    <p>בהפסקות מושמעים קטעי מוזיקה שונים. קטעים אלו אינם חלק מהניסוי, ואין להתייחס אליהם בתשובות. לאחר כל קטע תעברו לדיאלוג הבא.</p>\n  </React.Fragment>\n);\n\nexport const second_experiment_intro = (\n  <React.Fragment>\n    <p>בחלק זה של הניסוי תשמעו כמה קטעים מוזיקאליים הדומים לדיאלוגים שהושמעו במהלך הניסוי.</p>\n    <p>בניגוד לחלקים הקודמים של הניסוי, הפעם לא תתבקשו לענות על שאלות מטפוריות אודות \"דוברים\", אלא על שאלה המתייחסת ישירות למאפיינים המוזיקאליים של כל קטע. השאלה (שתחזור עבור כל קטע שתשמעו היא:</p>\n    <p>באיזו מידה מתאימים שני הצלילים המסיימים את הקטע (שכונה \"הדובר השני\" בחלקים הקודמים של הניסוי) לשמש כהמשך למוזיקה הקודמת להם (שכונתה \"הדובר הראשון\" בחלקים הקודמים של הניסוי)?</p>\n    <p>9 - במידה רבה מאד; 1 - כלל לא (השתמשו בכל הסקאלה כדי לציין דרגות שונות של התאמה).</p>\n    <p>אם הבנתם את השאלה - לחצו \"המשך\". אם משהו אינו ברור - צרו קשר עם הנסיין/ית.</p>\n  </React.Fragment>\n);\n\nexport const second_experiment_question = (\n  <p>\n    באיזו מידה מתאימים שני הצלילים המסיימים את הקטע לשמש כהמשך למוזיקה הקודמת להם?\n    <br/>\n    9 - במידה רבה מאד; 1 - כלל לא (השתמשו בכל הסקאלה כדי לציין דרגות שונות של התאמה).\n  </p>\n);\n\nexport const second_experiment_hear_again = (\n  <p>אם ברצונכם לשמוע שוב את הקטע, לחצו \"השמע\". לאחר שעניתם, לחצו \"המשך\" למעבר למסך הבא.</p>\n);\n\nexport const second_experiment_pause = <p>הפסקה קצרה: אנא הישארו במקומכם והקשיבו למוזיקה באמצעות האוזניות.</p>;\n\nexport const before_break_text = <p>הפסקה בת 10 דקות. אנא השאירו את מסך הניסוי פתוח וצרו קשר עם הנסיין/ית בתום ההפסקה.</p>;\n\nexport const after_break_text = <p>צרו קשר עם הנסיין/ית להנחיות נוספות. אין להתחיל בניסוי לפני קבלת אישור מהנסיין/ית.</p>;\n","import React from 'react';\nimport { ContinueButton, ComboBox, openFullscreen } from './ui.js';\nimport { login_text } from './texts.js';\n\nconst zero2hundred_options = [...Array(101).keys()].map(i => i);\nconst one2hundred_options = [...Array(100).keys()].map(i => i+1);\n\nexport const LoginScreen = ({next, data}) => {\n  const handleContinue = () => {\n    openFullscreen();\n    data.id = document.getElementById('id_input').value;\n    next();\n  };\n\n  return (\n    <div className=\"container\">\n      <div className=\"row\">\n        <div className=\"col-8 offset-2 breathing-top text-center\">\n          {login_text}\n        </div>\n      </div>\n      <div className=\"row\">\n        <div className=\"col text-center\">\n          <br/>\n          <label>מספר נבדק: <input type=\"text\" id=\"id_input\"/><br/></label>\n          <p hidden>\"</p>\n          <br/>\n          <br/>\n          <ContinueButton next={handleContinue}/>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport const FormScreen = ({next, data}) => {\n  const [error, setError] = React.useState(null);\n\n  const saveData = () => {\n    const age = document.getElementById('age').value;\n    if (age === \"\") {\n      setError(\"אנא ענו על כל השאלות.\");\n      return;\n    }\n\n    const genderMaleChecked = document.getElementById('male').checked;\n    const genderFemaleChecked = document.getElementById('female').checked;\n    if (!genderMaleChecked && !genderFemaleChecked) {\n      setError(\"אנא בחרו מין.\");\n      return;\n    }\n    const gender = genderMaleChecked ? 2 : 1;\n\n    const musical_performance_years = document.getElementById('musical_performance_years').value;\n    const musical_theory_years = document.getElementById('musical_theory_years').value;\n    if (musical_performance_years === \"\" || musical_theory_years === \"\") {\n      setError(\"אנא ענו על כל השאלות.\");\n      return;\n    }\n\n    const absoluteYesChecked = document.getElementById('absolute_yes').checked;\n    const absoluteNoChecked = document.getElementById('absolute_no').checked;\n    if (!absoluteYesChecked && !absoluteNoChecked) {\n      setError(\"אנא ענו על כל השאלות.\");\n      return;\n    }\n    const absolute_hearing = absoluteYesChecked ? \"yes\": \"no\";\n\n    const musicianYesChecked = document.getElementById('musician_yes').checked;\n    const musicianNoChecked = document.getElementById('musician_no').checked;\n    if (!musicianYesChecked && !musicianNoChecked) {\n      setError(\"אנא ענו על כל השאלות.\");\n      return;\n    }\n    const is_musician = musicianYesChecked ? \"yes\": \"no\";\n    \n    const native_language = document.getElementById('native_language').value;\n    const musical_activity = document.getElementById('musical_activity').value;\n\n    const headphones = document.getElementById('headphones').value;\n    const computer = document.getElementById('computer').value;\n    const additional_devices = document.getElementById('additional_devices').value;\n    const location_details = document.getElementById('location_details').value;\n\n    if (native_language.trim() === \"\" ||\n        musical_activity.trim() === \"\" ||\n        headphones.trim() === \"\" ||\n        computer.trim() === \"\" ||\n        location_details.trim() === \"\") {\n      setError(\"אנא ענו על כל השאלות.\");\n      return;\n    }\n\n    data.age = age;\n    data.gender = gender;\n    data.musical_performance_years = musical_performance_years;\n    data.musical_theory_years = musical_theory_years;\n    data.absolute_hearing = absolute_hearing;\n    data.is_musician = is_musician;\n    data.native_language = native_language;\n    data.musical_activity = musical_activity;\n    data.headphones = headphones;\n    data.computer = computer;\n    data.additional_devices = additional_devices;\n    data.location_details = location_details;\n\n    next();\n  };\n\n  const error_div = error ? (\n      <div className=\"error\">\n        {error}\n      </div>\n    ) : null;\n\n  return (\n    <div className=\"container\">\n      <div className=\"row\">\n        <div className=\"col-md-8 offset-md-2 breathing-top\">\n          <p>מלאו בבקשה את השאלון שעל גבי המסך. אנא פנו לנסיין אם שאלה כלשהי אינה ברורה.</p>\n          <p>לאחר שסיימתם, הרכיבו אוזניות ולחצו \"המשך\".</p>\n        </div>\n      </div>\n      <div className=\"row\">\n        <div className=\"col-md-8 offset-md-2\">\n          <br/>\n          <label>גיל:</label><ComboBox id=\"age\" options={one2hundred_options}/>\n          <br/>\n          <label>מין:</label>\n          <input type=\"radio\" id=\"female\" name=\"gender\" value=\"female\"/><label>נקבה</label>\n          <input type=\"radio\" id=\"male\" name=\"gender\" value=\"male\"/><label>זכר</label>\n          <br/>\n          <label>שנות לימוד ביצוע מוזיקאלי (אם לא למדת - בחר 0):</label>\n          <ComboBox id=\"musical_performance_years\" options={zero2hundred_options}/>\n          <br/>\n          <label>שנות לימוד תיאוריה מוזיקאלית (אם לא למדת - בחר 0):</label>\n          <ComboBox id=\"musical_theory_years\" options={zero2hundred_options}/>\n          <br/>\n          <label>שמיעה אבסולוטית:</label>\n          <input type=\"radio\" id=\"absolute_yes\" name=\"absolute_hearing\" value=\"yes\"/><label>כן</label>\n          <input type=\"radio\" id=\"absolute_no\" name=\"absolute_hearing\" value=\"no\"/><label>לא</label>\n          <br/>\n          <label>מוזיקאי:</label>\n          <input type=\"radio\" id=\"musician_yes\" name=\"is_musician\" value=\"yes\"/><label>כן</label>\n          <input type=\"radio\" id=\"musician_no\" name=\"is_musician\" value=\"no\"/><label>לא</label>\n          <br/>\n          <label>שפת אם:</label><input type=\"text\" id=\"native_language\"/>\n          <br/>\n          <label>כלי נגינה או פעילות מוזיקאלית:</label>\n          <input type=\"text\" id=\"musical_activity\"/>\n          <br/><br/>\n          <p>ציינו באיזה ציוד השתמשתם (דייקו ככל האפשר):</p>\n          <label>אזניות (חברה ודגם):</label><input type=\"text\" id=\"headphones\" size=\"50\"/><br/>\n          <label>מחשב ומסך:</label><input type=\"text\" id=\"computer\" size=\"50\"/><br/>\n          <label>מיכשור וציוד נוסף, אם רלבנטי:</label><input type=\"text\" id=\"additional_devices\" size=\"40\"/><br/>\n          <label>פרטים על מיקום הניסוי:</label><input type=\"text\" id=\"location_details\" size=\"50\"/><br/>\n        </div>\n      </div>\n      <div className=\"row\">\n        <div className=\"col text-center\">\n          <br/>\n          <p>המטלות מנוסחות בלשון זכר, אך מכוונות לכל המגדרים.</p>\n          <ContinueButton label=\"המשך\" next={saveData}/>\n          {error_div}\n        </div>\n      </div>\n    </div>\n  );\n};\n\n","import React from 'react';\nimport { questions_text } from './texts.js';\nimport { Button, ContinueButton, ComboBox } from './ui.js';\nimport { second_experiment_question, \n         second_experiment_hear_again } from './texts.js';\n\nimport { confirmAlert } from 'react-confirm-alert';\nimport 'react-confirm-alert/src/react-confirm-alert.css';\nimport './confirm-alert.css';\n\nconst numbered_options = [...Array(9).keys()].map(i => i+1);\nconst taste_options = [\"מתוק\", \"חמוץ\", \"מר\", \"מלוח\"];\n\nclass XYselection extends React.Component {\n  constructor({width, height, disabled, onUpdate}) {\n    super();\n    this.canvasRef = React.createRef();\n  }\n\n  componentDidMount() {\n    this.ctx = this.canvasRef.current.getContext('2d');\n    this.draw_axes();\n  }\n  \n  draw_axes = () => {\n    const {width, height} = this.props;\n    const ctx = this.ctx;\n\n    ctx.fillStyle = 'black';\n    ctx.lineWidth = '4';\n    ctx.strokeRect(2, 2, width-4, height-4);\n    const c_x = width / 2;\n    const c_y = height / 2;\n\n    ctx.beginPath();\n    ctx.moveTo(c_x, 0);\n    ctx.lineTo(c_x, height);\n    ctx.moveTo(0, c_y);\n    ctx.lineTo(width, c_y);\n    ctx.closePath();\n    ctx.stroke();\n  }\n  \n  canvas_click = (e) => {\n    const {onUpdate, disabled, width, height} = this.props;\n    if (disabled)\n      return;\n\n    const rect = this.canvasRef.current.getBoundingClientRect();\n    const px = e.clientX - rect.left;\n    const py = e.clientY - rect.top;\n\n    const x = (px - width/2) / (width/2);\n    const y = -(py - height/2) / (height/2);\n    \n    this.ctx.clearRect(0, 0, width, height);\n    this.draw_axes();\n\n    this.ctx.beginPath();\n    this.ctx.arc(px, py, 8, 0, 2*Math.PI);\n    this.ctx.fillStyle = \"#007bff\";\n    this.ctx.fill();\n\n    const confirm_update = () => {\n      this.prev_px = px;\n      this.prev_py = py;\n\n      if (onUpdate)\n        onUpdate(x, y);      \n    };\n\n    const cancel_update = () => {\n      this.ctx.clearRect(0, 0, width, height);\n      this.draw_axes();\n\n      if (this.prev_px) {\n        this.ctx.beginPath();\n        this.ctx.arc(this.prev_px, this.prev_py, 8, 0, 2*Math.PI);\n        this.ctx.fillStyle = \"#007bff\";\n        this.ctx.fill();\n      }\n    };\n    \n    confirmAlert({\n      message: \"האם את/ה בטוח/ה?\",\n      buttons: [\n        { label: \"כן\", onClick: confirm_update },\n        { label: \"לא\", onClick: cancel_update }\n      ],\n      onClickOutside: cancel_update,\n      closeOnEscape: false\n    });\n  }\n\n  render() {\n    const {width, height} = this.props;\n\n    return (\n      <React.Fragment>\n        <div className=\"text-center xy-selection\">\n          <p className=\"yaxis-label\">מלא אנרגיה</p>\n          <span className=\"xaxis-label\">רגשות חיוביים</span>\n          <canvas className=\"xycanvas\" ref={this.canvasRef} width={width} height={height} onClick={this.canvas_click}/>\n          <span className=\"xaxis-label\">רגשות שליליים</span>\n          <p className=\"yaxis-label\">חסר אנרגיה</p>\n        </div>\n\n      </React.Fragment>\n    );\n  }\n};\n\nexport const FirstExperimentTrialUI = ({next, replay, trial_data, question_order, disable_buttons, disable_questions}) => {\n  const [error, setError] = React.useState(null);\n  const [emotion_value, setEmotion] = React.useState(null);\n  const [energy_value, setEnergy] = React.useState(null);\n\n  const ordered_questions = question_order.map(i => (\n    <div className=\"trial-question\" key={i}>\n      <label htmlFor={\"ordered\"+i}>{questions_text.ordered_questions[i]}</label>\n      <ComboBox id={\"ordered\"+i} options={numbered_options} disabled={disable_questions} prevent_keypress={true}/>\n    </div>\n  ));\n\n  const xy_click = (x, y) => {\n    setEmotion(x);\n    setEnergy(y);\n  };\n\n  const handle_next = () => {\n    const first_answer = document.getElementById(\"first_question\").value;\n    if (first_answer === \"\") {\n      setError(\"אנא ענו על כל השאלות.\");\n      return;\n    }\n\n    const ordered_answers = Array(ordered_questions.length);\n\n    for (let i=0; i<ordered_questions.length; i++) {\n      const answer = document.getElementById(\"ordered\"+i).value;\n      if (answer === \"\") {\n        setError(\"אנא ענו על כל השאלות.\");\n        return;\n      }\n      ordered_answers[i] = answer;\n    }\n\n    if (emotion_value===null || energy_value===null) {\n      setError(\"אנא ענו על כל השאלות.\");\n      return;\n    }\n\n    const taste_answer = document.getElementById(\"taste_question\").value;\n    if (taste_answer === \"\") {\n      console.log(\"taste\");\n      setError(\"אנא ענו על כל השאלות.\");\n      return;\n    }\n\n    if (trial_data !== null) {\n      Object.assign(trial_data, {\n        time: new Date().toString(),\n        question_1: first_answer,\n        question_2: ordered_answers[0],\n        question_3: ordered_answers[1],\n        question_4: ordered_answers[2],\n        question_5: ordered_answers[3],\n        emotion: emotion_value,\n        energy: energy_value,\n        taste: taste_answer,\n      });\n    }\n\n    next();\n  };\n\n  const error_div = error ? (\n      <div className=\"error\">\n        {error}\n      </div>\n    ) : null;\n\n  return (\n    <div className=\"container\">\n      <div className=\"row tiny-breathing-top\">\n        <div className=\"col-12\">\n          <div className=\"trial-question\">\n            <label htmlFor=\"first_question\">{questions_text.first_question}</label>\n            <ComboBox id=\"first_question\" options={numbered_options} disabled={disable_questions} prevent_keypress={true}/> \n          </div>\n\n          {ordered_questions}\n\n          <div className=\"trial-question row\">\n            <div className=\"col-6 xy-label\">\n              {questions_text.xy_question}\n            </div>\n            <div className=\"col-6\">\n              <XYselection id=\"energy_emotion_question\" width={220} height={220} onUpdate={xy_click} disabled={disable_questions}/>\n            </div>\n          </div>\n\n          <div className=\"trial-question\">\n            <label htmlFor=\"taste_question\">{questions_text.taste_question}</label>\n            <ComboBox id=\"taste_question\" options={taste_options} disabled={disable_questions} prevent_keypress={true}/>\n          </div>\n        </div>\n      </div>\n      <div className=\"row\">\n        <div className=\"col-md-2 offset-md-3 text-center\">\n          <Button label=\"השמע שוב\" onClick={replay} disabled={disable_buttons}/>\n        </div>\n        <div className=\"col-md-2 offset-md-2 text-center\">\n          <ContinueButton next={handle_next} disabled={disable_buttons}/>\n        </div>\n      </div>\n      <div className=\"row\">\n        <div className=\"col-12 text-center\">\n          {error_div}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport const SecondExperimentTrialUI = ({next, replay, trial_data, disable_buttons, disable_question}) => {\n  const [error, setError] = React.useState(null);\n\n  const handle_next = () => {\n    const answer = document.getElementById(\"question\").value;\n    if (answer === \"\") {\n      setError(\"אנא ענו על השאלה.\");\n      return;\n    }\n\n    Object.assign(trial_data, {\n      time: new Date().toString(),\n      musical_question: answer,\n    });\n\n    next();\n  };\n\n  const error_div = error ? (\n    <div className=\"error\">\n      {error}\n    </div>\n  ) : null;\n\n  return (\n    <div className=\"container\">\n      <div className=\"row breathing-top\">\n        <div className=\"col-8 offset-2\">\n          {second_experiment_question}\n          <br/>\n          <div className=\"text-center second-experiment-question\">\n            <ComboBox id=\"question\" options={numbered_options} disabled={disable_question}/>\n          </div>\n          <br/>\n          {second_experiment_hear_again}\n          <br/>\n        </div>\n      </div>\n      <div className=\"row\">\n        <div className=\"col-md-2 offset-md-3 text-center\">\n          <Button label=\"השמע שוב\" onClick={replay} disabled={disable_buttons}/>\n        </div>\n        <div className=\"col-md-2 offset-md-2 text-center\">\n          <ContinueButton next={handle_next} disabled={disable_buttons}/>\n        </div>\n      </div>\n      <div className=\"row\">\n        <div className=\"col-12 text-center\">\n          {error_div}\n        </div>\n      </div>\n    </div>\n  );\n};\n","export const Instrument = {\n  PIANO: 0,\n  STRINGS: 1,\n};\n\nexport const str_to_instrument = (sinst) => {\n  if (sinst.toLowerCase() === \"piano\")\n    return Instrument.PIANO;\n  else if (sinst.toLowerCase() === \"strings\")\n    return Instrument.STRINGS;\n  else return null;\n};\n\nexport const other_instrument = (instrument) => {\n  if (instrument === Instrument.PIANO)\n    return Instrument.STRINGS;\n  else if (instrument === Instrument.STRINGS)\n    return Instrument.PIANO;\n  else return null;\n};\n\nexport const music_key_to_idx = {\n  \"C\": 0,\n  \"Db\": 1,\n  \"D\": 2,\n  \"Eb\": 3,\n  \"E\": 4,\n  \"F\": 5,\n  \"Gb\": 6,\n  \"G\": 7,\n  \"Ab\": 8,\n  \"A\": 9,\n  \"Bb\": 10,\n  \"B\": 11,\n};\n\nconst audio_ext = \".mp3\";\n\nconst base_audio_dir = \"/tonalexp2/audio/\";\nconst pause_dir = \"pause/\";\nconst instrument_dir = {\n  [Instrument.PIANO]: \"piano/\",\n  [Instrument.STRINGS]: \"strings/\",\n};\n\nconst trial_audio = {\n  [Instrument.PIANO]: [\n    \"Cm\",\n    \"Dbm\",\n    \"Dm\",\n    \"Ebm\",\n    \"Em\",\n    \"Fm\",\n    \"Gbm\",\n    \"Gm\",\n    \"Abm\",\n    \"Am\",\n    \"Bbm\",\n    \"Bm\",\n  ],\n\n  [Instrument.STRINGS]: [\n    \"Cm_str\",\n    \"Dbm_str\",\n    \"Dm_str\",\n    \"Ebm_str\",\n    \"Em_str\",\n    \"Fm_str\",\n    \"Gbm_str\",\n    \"Gm_str\",\n    \"Abm_str\",\n    \"Am_str\",\n    \"Bbm_str\",\n    \"Bm_str\",\n  ],\n};\n\nexport const pause_audio_paths = [...Array(11).keys()].map(i => base_audio_dir + pause_dir + (i+1) + audio_ext);\n\nexport const trial_audio_paths = (instrument) => {\n  return trial_audio[instrument].map(n => base_audio_dir + instrument_dir[instrument] + n + audio_ext);\n};\n\nexport const part_two_noise_path = base_audio_dir + pause_dir + \"noise10sec\" + audio_ext\n","export function repeatArray(arr, count) {     \n  var ln = arr.length;\n  var b = [];\n  for(let i=0; i<count; i++) {      \n    b.push(arr[i%ln]);      \n  }\n      \n  return b;      \n}\n\n/* random int between min and max inclusive. */\nexport const randomInt = (min, max) => \n  Math.floor(Math.random() * (max - min + 1) + min);\n\nexport const randomElement = arr => arr[randomInt(0, arr.length-1)];\n\nexport const shuffleArray = arr => arr\n  .map(a => [Math.random(), a])\n  .sort((a, b) => a[0] - b[0])\n  .map(a => a[1]);\n\nexport const randomSequence = (items, length) => shuffleArray(repeatArray(items, length));\n","export class AudioController {\n  constructor(srcs, onDoneLoading, onAudioEnded) {\n    this.players = [];\n    this.ids2players = {};\n    this.players2ids = {};\n\n    for (const id of srcs) {\n      const playerIdx = this.players.length;\n\n      if (id in this.ids2players) {\n        continue;\n      }\n\n      this.ids2players[id] = playerIdx;\n      this.players2ids[playerIdx] = id;\n\n      const p = new Audio(id);\n      p.addEventListener('canplaythrough', (e => this.audioLoaded(p)), false);\n      p.addEventListener('ended', (e => {\n        if (this.onAudioEnded) this.onAudioEnded(id);\n      }), false);\n      p.onerror = e => {\n        console.log(\"Error loading audio file: \" + id + \" (error code: \" + p.error.code + \").\");\n      };\n\n      this.players.push(p);\n    }\n\n    console.log(\"Loading \" + this.players.length + \" audio files\");\n    this.loadCount = 0;\n    this.onDoneLoading = onDoneLoading;\n    this.onAudioEnded = onAudioEnded;\n  }\n\n  audioLoaded(player) {\n    this.loadCount+=1;\n    if (this.loadCount === this.players.length) {\n      if (this.onDoneLoading) this.onDoneLoading();\n    }\n  }\n\n  play(audio_id) {\n    const playerIdx = this.ids2players[audio_id];\n    this.players[playerIdx].play()\n      .catch(err => {\n        console.log(\"Error while playing audio file: \" + err);\n      });\n  }\n\n  stop(audio_id) {\n    const playerIdx = this.ids2players[audio_id];\n    this.players[playerIdx].pause();\n    this.players[playerIdx].currentTime = 0;\n  }\n}\n","import React from 'react';\nimport { FirstExperimentTrialUI } from './ExperimentUI.js';\nimport ls from 'local-storage';\nimport { InfoScreen } from './ui.js';\nimport { trial_audio_paths, pause_audio_paths } from './audio_mapping.js';\nimport { shuffleArray } from './randomize.js';\nimport { AudioController } from './audio_controller.js';\nimport { first_experiment_pause } from './texts.js';\n\nexport class FirstExperimentBlock extends React.Component {\n  trial_num = 12\n\n  ls_prefix = \"first_experiment_block_\"\n\n  state = {\n    trial_idx: 0,\n    on_pause: false,\n    is_playing: true,\n    play_count: 0,\n  }\n\n  constructor({next, data, question_order, audio_controller}) {\n    super();\n    this.next = next;\n    this.data = data;\n    this.question_order = question_order;\n    this.audio_controller = audio_controller;\n\n    const cont_trial_seq = ls.get(this.ls_prefix + \"trial_sequence\");\n\n    if (cont_trial_seq) {\n      console.log(\"Continuing first experiment block...\");\n\n      this.trial_sequence = cont_trial_seq;\n      this.pause_sequence = ls.get(this.ls_prefix + \"pause_sequence\");\n      this.state.trial_idx = ls.get(this.ls_prefix + \"trial_idx\");\n    }\n    else {\n      const all_audio = trial_audio_paths(this.data.cur_instrument);\n      const first_audio = all_audio[this.data.first_key];\n      const second_audio = all_audio[this.data.first_key === 5 ? 11 : 5];\n        \n      const rest_audio = shuffleArray(all_audio).filter(a => a !== first_audio && a !== second_audio);\n      this.trial_sequence = [first_audio, second_audio].concat(rest_audio);\n      this.pause_sequence = shuffleArray(pause_audio_paths);\n\n      ls.set(this.ls_prefix + \"trial_sequence\", this.trial_sequence);\n      ls.set(this.ls_prefix + \"pause_sequence\", this.pause_sequence);\n      ls.set(this.ls_prefix + \"trial_idx\", this.state.trial_idx);\n\n      for (let i = 0; i < this.trial_num; i++) {\n        const td = {\n          experiment_number: 1,\n          trial_number: i+1,\n          instrument: this.data.cur_instrument,\n          audio: this.trial_sequence[i],\n        };\n\n        this.data.trials.push(td);\n      }\n\n      ls.set(\"data\", this.data);\n    }\n    \n    this.audio_controller.onAudioEnded = () => {\n      this.setState({is_playing: false});\n    };\n\n    console.log(\"trial_sequence:\");\n    console.log(this.trial_sequence);\n    console.log(\"pause sequence:\");\n    console.log(this.pause_sequence);\n  }\n\n  componentDidMount() {\n    this.start_time = new Date().getTime();\n    this.playTrial(this.state.trial_idx);\n  }\n\n  nextTrial = () => {\n    const { trial_idx } = this.state;\n\n    this.setState({on_pause: false});\n    this.start_time = new Date().getTime();\n    this.playTrial(trial_idx);\n  }\n\n  playTrial = (trial_idx) => {\n    this.audio_controller.play(this.trial_sequence[trial_idx]);\n    this.setState({is_playing: true,\n                   play_count: this.state.play_count + 1});\n  }\n\n  startPause = () => {\n    const { trial_idx } = this.state;\n    const trial_data = this.data.trials[trial_idx];\n\n    trial_data.RT = new Date().getTime() - this.start_time;\n    trial_data.play_count = this.state.play_count;\n\n    ls.set(\"data\", this.data);\n\n    if (trial_idx < this.trial_num - 1) {\n      this.setState({on_pause: true,\n                     trial_idx: trial_idx + 1,\n                     play_count: 0});\n      ls.set(this.ls_prefix + \"trial_idx\", trial_idx + 1);\n\n      const pause_path = this.pause_sequence[trial_idx];\n      \n      const onDoneLoading = () => {\n        pause_audio.play(pause_path);\n      };\n      \n      const onAudioEnded = () => {\n        this.setState({enable_pause_continue: true});\n      };\n      \n      const pause_audio = new AudioController([pause_path], onDoneLoading, onAudioEnded);\n      this.setState({enable_pause_continue: false});\n      \n    }\n    else {\n      this.next();\n    }\n\n  }\n\n  render() {\n    const { trial_idx, on_pause, enable_pause_continue, play_count } = this.state;\n    const trial_data = this.data.trials[trial_idx];\n\n    if (on_pause) {\n      return (\n        <InfoScreen info={first_experiment_pause} \n                    next={this.nextTrial} \n                    key={trial_idx} \n                    continue_disabled={!enable_pause_continue} />\n      );\n    }\n    else {\n      return (\n        <FirstExperimentTrialUI next={this.startPause} \n                                replay={() => this.playTrial(trial_idx)} \n                                trial_data={trial_data} \n                                question_order={this.question_order} \n                                disable_buttons={this.state.is_playing}\n                                disable_questions={this.state.is_playing && play_count === 1}\n                                key={trial_idx} />      \n      );\n    }\n  }\n}\n","import React from 'react';\nimport './Experiment.css';\nimport { LoadingScreen, InfoScreen, ContinueButton, Button } from './ui.js';\nimport { FirstExperimentBlock } from './FirstExperimentBlock.js';\nimport { FirstExperimentTrialUI } from './ExperimentUI.js';\nimport { first_experiment_intro, \n         first_experiment_training_info, \n         first_experiment_training_end } from './texts.js';\nimport { shuffleArray, randomElement } from './randomize.js';\nimport { AudioController } from './audio_controller.js';\nimport { pause_audio_paths, trial_audio_paths } from './audio_mapping.js';\nimport ls from 'local-storage';\n\nconst IntroScreen = ({play, next, done_playing, disable_buttons}) => {\n  const second_part = done_playing ? (\n    <div className=\"row\">\n      <div className=\"col-8 offset-2\">\n        <br/>\n        {first_experiment_intro[1]}\n        <div className=\"text-center\">\n          <ContinueButton next={next} disabled={disable_buttons} />\n        </div>\n      </div>\n    </div>\n  ) : null;\n\n  return (\n      <div className=\"container\">\n        <div className=\"row\">\n          <div className=\"col-8 offset-2 breathing-top\">\n            {first_experiment_intro[0]}\n            <div className=\"text-center\">\n              <Button label=\"נסה\" onClick={play} disabled={disable_buttons} />\n            </div>          \n          </div>\n        </div>\n        {second_part}\n      </div>\n  );\n};\n\nexport class FirstExperiment extends React.Component {\n  ls_prefix = \"first_experiment_\"\n\n  steps = {\n    INTRO: 1,\n    TRAINING_INFO: 2,\n    TRAINING: 3,\n    EXPERIMENT_INFO: 4,\n    EXPERIMENT_BLOCK: 5,\n  }\n\n  state = {\n    step: 1,\n    is_loading: true,\n    is_playing: false,\n    disable_intro_buttons: false,\n  }\n  \n  constructor({data, next}) {\n    super();\n    this.next = next;\n    this.data = data;\n\n    this.question_order = ls.get(this.ls_prefix + \"question_order\");\n    if (!this.question_order) {\n      this.question_order = shuffleArray([0,1,2,3]);\n      ls.set(this.ls_prefix + \"question_order\", this.question_order);\n    }\n\n    const all_audio = trial_audio_paths(this.data.cur_instrument);\n    console.log(\"all_audio\");\n    console.log(all_audio);\n    this.audio_srcs = all_audio.concat(pause_audio_paths);\n    this.intro_audio = randomElement(all_audio);\n    this.training_audio = randomElement(all_audio);\n\n    console.log(`intro: ${this.intro_audio}`);\n    console.log(`training: ${this.training_audio}`);\n\n    const cont_step = ls.get(this.ls_prefix + \"step\");\n    if (cont_step) {\n      this.state.step = cont_step;\n    }\n\n  }\n\n  componentDidMount() {\n    const onDoneLoading = () => {\n      console.log(\"Done loading audio files.\");\n      this.setState({is_loading: false});\n      if (this.state.step === this.steps.TRAINING) {\n        this.playTraining();\n      }\n    };\n\n    const onAudioEnded = () => {\n      this.setState({is_playing: false});\n\n      if (this.state.step === this.steps.INTRO)\n        this.setState({disable_intro_buttons: false,\n                       done_playing_intro: true});\n      else\n        this.setState({is_playing: false});\n    };\n\n    this.audio_controller = new AudioController(this.audio_srcs, onDoneLoading, onAudioEnded);\n  }\n\n  nextStep = () => {\n    const { step } = this.state;\n    if (step === this.steps.EXPERIMENT_BLOCK) {\n      console.log(\"Finished first experiment. Data:\");\n      console.log(this.data);\n      this.next();\n    }\n    else {\n      const new_step = step + 1;\n    \n      ls.set(this.ls_prefix + \"step\", new_step);\n      this.setState({step: new_step});\n\n      if (new_step === this.steps.TRAINING) {\n        this.playTraining();\n      }\n    }\n  }\n\n  playIntro = () => {\n    this.setState({disable_intro_buttons: true,\n                   is_playing: true});\n    this.audio_controller.play(this.intro_audio);\n  }\n\n  playTraining = () => {\n    this.audio_controller.play(this.training_audio);\n    this.setState({is_playing: true});\n  }\n  \n\n  render() {\n    const {step, is_loading} = this.state;\n\n    if (is_loading) {\n      return <LoadingScreen />;\n    }\n\n    switch(step) {\n    case this.steps.INTRO:\n      return (\n        <IntroScreen next={this.nextStep} \n                     key={step} \n                     play={this.playIntro} \n                     done_playing={this.state.done_playing_intro} \n                     disable_buttons={this.state.disable_intro_buttons} />\n      );\n    case this.steps.TRAINING_INFO:\n      return <InfoScreen info={first_experiment_training_info} next={this.nextStep} key={step} />;\n    case this.steps.TRAINING:\n      return (\n        <FirstExperimentTrialUI next={this.nextStep} \n                                replay={this.playTraining} \n                                trial_data={null} \n                                question_order={this.question_order} \n                                key={step} \n                                disable_buttons={this.state.is_playing}\n                                disable_questions={this.state.is_playing} /> // when training we don't count replays.\n      );\n    case this.steps.EXPERIMENT_INFO:\n      return <InfoScreen info={first_experiment_training_end} next={this.nextStep} key={step} />;\n    case this.steps.EXPERIMENT_BLOCK:\n      return (\n        <FirstExperimentBlock next={this.nextStep} \n                              data={this.data} \n                              key={step} \n                              question_order={this.question_order} \n                              audio_controller={this.audio_controller} />\n      );\n    default:\n      return null;\n    }\n  };\n}\n","import React from 'react';\nimport './Experiment.css';\nimport { LoadingScreen, InfoScreen } from './ui.js';\nimport { second_experiment_intro, \n         second_experiment_pause } from './texts.js';\nimport { SecondExperimentTrialUI } from './ExperimentUI.js';\nimport { Instrument, trial_audio_paths, part_two_noise_path } from './audio_mapping.js';\nimport { shuffleArray } from './randomize.js';\nimport { AudioController } from './audio_controller.js';\nimport ls from 'local-storage';\n\nexport class SecondExperiment extends React.Component {\n  num_trials = 24\n\n  ls_prefix = \"second_experiment_\"\n\n  state = {\n    trial_idx: 0,\n    show_info: true,\n    on_pause: false,\n    is_playing: true,\n    play_count: 0,\n  }\n\n  constructor({data, next, audio_controller}) {\n    super();\n    this.next = next;\n    this.data = data;\n\n    const cont_seq = ls.get(this.ls_prefix + \"sequence\");\n    \n    if (cont_seq) {\n      console.log(\"Continuing second experiment...\");\n\n      this.sequence = cont_seq;\n      this.state.trial_idx = ls.get(this.ls_prefix + \"trial_idx\");\n      this.state.show_info = ls.get(this.ls_prefix + \"show_info\");\n    }\n    else {\n      const piano_trials = trial_audio_paths(Instrument.PIANO).map(p => [p, Instrument.PIANO]);\n      const strings_trials = trial_audio_paths(Instrument.STRINGS).map(p => [p, Instrument.STRINGS]);\n      this.sequence = shuffleArray(piano_trials.concat(strings_trials));\n\n      ls.set(this.ls_prefix + \"sequence\", this.sequence);\n      ls.set(this.ls_prefix + \"trial_idx\", this.state.trial_idx);\n      ls.set(this.ls_prefix + \"show_info\", this.state.show_info);\n    }\n    const onAudioEnded = () => {\n      this.setState({is_playing: false});\n    };\n\n    const onDoneLoading = () => {\n      this.setState({is_loading: false});\n    };\n\n    const audio_files = this.sequence.map(t => t[0]).concat([part_two_noise_path]);\n    this.audio_controller = new AudioController(audio_files, onDoneLoading, onAudioEnded);\n    console.log(\"Second experiment sequence:\");\n    console.log(this.sequence);\n  }\n\n  componentDidMount() {\n    const added_trials = ls.get(this.ls_prefix + \"added_trials\");\n    if (!added_trials) {\n      console.log(\"Adding trials\");\n      this.first_trial_data = this.data.trials.length;\n      for (let i = 0; i < this.num_trials; i++) {\n        const td = {\n          experiment_number: 2,\n          trial_number: i+1,\n          instrument: this.sequence[i][1],\n          audio: this.sequence[i][0],\n        };\n\n        this.data.trials.push(td);\n      }\n      ls.set(\"data\", this.data);\n      ls.set(this.ls_prefix + \"added_trials\", true);\n    }\n    else {\n      this.first_trial_data = this.data.trials.length - this.num_trials;\n    }\n\n    if (!this.state.show_info) {\n      this.startTrials();\n    }\n  }\n\n  nextTrial = () => {\n    this.setState({on_pause: false});\n    this.start_time = new Date().getTime();\n    this.playTrial(this.state.trial_idx);\n  }\n\n  startTrials = () => {\n    this.setState({show_info: false});\n    this.start_time = new Date().getTime();\n    this.playTrial(this.state.trial_idx);\n\n    ls.set(this.ls_prefix + \"show_info\", false);\n  }\n\n  startPause = () => {\n    const { trial_idx } = this.state;\n    const trial_data = this.data.trials[trial_idx + this.first_trial_data];\n    trial_data.RT = new Date().getTime() - this.start_time;\n    trial_data.play_count = this.state.play_count;\n    ls.set(\"data\", this.data);\n\n    if (trial_idx < this.num_trials - 1) {\n      this.setState({on_pause: true,\n                     trial_idx: trial_idx + 1,\n                     is_playing: true,\n                     play_count: 0});\n      ls.set(this.ls_prefix + \"trial_idx\", trial_idx + 1);\n      this.audio_controller.play(part_two_noise_path);\n    }\n    else {\n      this.next();\n    }\n  }\n  \n  playTrial = (trial_idx) => {\n    this.audio_controller.play(this.sequence[trial_idx][0]);\n    this.setState({is_playing: true,\n                   play_count: this.state.play_count + 1});\n  }\n\n  render() {\n    const { trial_idx, show_info, is_loading, is_playing, on_pause, play_count } = this.state;\n    if (is_loading) {\n      return <LoadingScreen/>;\n    }\n    else if (show_info) {\n      return (\n        <InfoScreen info={second_experiment_intro} next={this.startTrials} />\n      );\n    }\n    else if (on_pause) {\n      return (\n        <InfoScreen info={second_experiment_pause} \n                    next={this.nextTrial}\n                    key={trial_idx}\n                    continue_disabled={is_playing} />\n      );\n    }\n    else {\n      const trial_data = this.data.trials[this.first_trial_data + trial_idx];\n\n      return (\n        <SecondExperimentTrialUI next={this.startPause}\n                                 replay={() => this.playTrial(trial_idx)}\n                                 trial_data={trial_data}\n                                 disable_buttons={is_playing} \n                                 disable_question={is_playing && play_count === 1}/>\n      );\n    }\n  }\n}\n","import React from 'react';\nimport './Experiment.css';\nimport ls from 'local-storage';\nimport { LoadingScreen, ContinueButton, ErrorScreen, InfoScreen, openFullscreen } from './ui.js';\nimport { SessionEvent, does_user_sheet_exists, read_subject_data, writeSessionEvent, readSessionData } from './sessions.js';\nimport { LoginScreen, FormScreen } from './login.js';\nimport gs from './spreadsheet_io.js';\nimport { FirstExperiment } from './FirstExperiment.js';\nimport { SecondExperiment } from './SecondExperiment.js';\nimport { other_instrument, str_to_instrument, music_key_to_idx } from './audio_mapping.js';\nimport { intro_texts, before_break_text, after_break_text } from './texts.js';\n\n\nconst BREAK_LENGTH = 10 * 60; // break length between experiment 1 and 2 in seconds.\n\nconst FinishScreen = ({data, done_saving}) => {\n  return (\n    <div className=\"container\">\n      <div className=\"col-md-8 offset-md-2 finish-screen text-center\">\n        <h1>תודה רבה על השתתפותכם בניסוי</h1>\n        <br/>\n        <h1>אנא צרו קשר עם הנסיין</h1>\n        <p>{done_saving ? \"הנתונים נשמרו בהצלחה!\" : \"אנא המתינו לשמירת הנתונים...\"}</p>\n      </div>\n    </div>\n  );\n};\n\nconst FeedbackScreen = ({next, data}) => {\n  const save_data = () => {\n    const experience_question = document.getElementById('experience_question').value;\n    const dialog_question = document.getElementById('dialog_question').value;\n    const td = {\n      time: new Date().toString(),\n      experience_question: experience_question,\n      dialog_question: dialog_question\n    };\n    data.trials.push(td);\n    ls.set(\"data\", data);\n    next();\n  };\n\n  return (\n    <div className=\"container\">\n      <div className=\"row\">\n        <div className=\"col-8 offset-2 breathing-top\">\n          <p>לפני סיום, נבקשכם לענות על שתי שאלות הקשורות לחוויה הכוללת של ההשתתפות בניסוי.</p>\n          <label htmlFor=\"experience_question\">כתבו כאן כל דבר הנוגע לניסוי ולחוויתכם במהלכו שנראה לכם ראוי לציון:</label>\n          <textarea id=\"experience_question\" rows=\"5\" cols=\"70\"/>\n\n          <label htmlFor=\"dialog_question\">מהו לדעתכם העקרון לפיו נוצרו ה\"דיאלוגים\" בניסוי? מה ההבדל ביניהם? (ניתן לכתוב \"לא יודע/ת\"):</label>\n          <textarea id=\"dialog_question\" rows=\"5\" cols=\"70\"/>\n        </div>\n      </div>\n      <div className=\"row\">\n        <div className=\"col-8 offset-2 text-center\">\n          <ContinueButton next={save_data} />\n        </div>\n      </div>\n    </div>\n  );\n};\n\nconst BreakScreen = ({next}) => {\n  const [disabled, setDisabled] = React.useState(true);\n  const [step, setStep] = React.useState(0);\n  \n  React.useEffect(() => { // run once\n    const cont_step = ls.get(\"break_step\");\n    if (cont_step !== null) {\n      console.log(\"cont\" + cont_step);\n      setStep(cont_step);\n      setDisabled(ls.get(\"break_disabled\"));\n    }\n    else {\n      ls.set(\"break_step\", 0);\n      ls.set(\"break_disabled\", true);\n    }\n  }, []);\n\n  const next_screen = () => {\n    if (step === 0) {\n      openFullscreen();\n      setStep(1);\n      ls.set(\"break_step\", 1);\n    }\n    else {\n      next();\n    }\n  };\n\n  setTimeout(() => { \n    setDisabled(false);\n    ls.set(\"break_disabled\", false);\n  }, 1000 * BREAK_LENGTH);\n\n  const cur_text = step === 0 ? before_break_text : after_break_text;\n\n  return (\n    <InfoScreen info={cur_text} next={next_screen} continue_disabled={disabled}/>\n  );\n};\n\nclass App extends React.Component {\n  ls_prefix = \"experiment_\"\n\n  conn = { // read/write connection details for google spreadsheet.    \n    spreadsheet_id: '1C_EqpYYpm_7m6kg7hKM3Hb_KA2klVQoxNdi76ixSff0',\n    api_key: 'AIzaSyDHFHbGy_GhEt1Q4FW61YYEX2jk3hZcSoQ',\n    write_url: 'https://script.google.com/macros/s/AKfycbzQm7gO2U92R5BIUggG2AMMbxaiGX5ek6Pql374Dbj2hvtzFeaY/exec'\n  }\n\n  steps = {\n    LOGIN: 1,\n    INTRO: 2,\n    FORM: 3,\n    EXPERIMENT1: 4,\n    EXPERIMENT2: 5,\n    FEEDBACK: 6,\n    FINISH: 7,\n  }\n\n  state = {\n    step: 1,\n    error: null,\n    loading: false,\n  }\n\n  data = {\n    trials: [],\n  }\n\n  nextStep = () => {\n    const { step } = this.state;\n\n    this.setStep(step + 1);\n  }\n\n  stepWillChange = (step, new_step) => {\n    if (step === this.steps.LOGIN) {\n      this.handleLogin();\n    }\n    else if (step === this.steps.FORM) {\n      ls.set(\"data\", this.data);\n    }\n    else if (new_step === this.steps.FORM) {\n      // Skip form on second session.\n      if (this.data.session_number === 2) {\n        return new_step + 1;\n      }\n    }\n    else if (new_step === this.steps.EXPERIMENT1 + 1) {\n      // Show second experiment and break only on second session\n      if (this.data.session_number === 1)\n        return this.steps.FINISH;\n    }\n\n    return null;\n  }\n\n  setStep = (new_step) => {\n    const { step } = this.state;\n    if (new_step !== step) {\n      const altered_step = this.stepWillChange(step, new_step);\n      if (altered_step) {\n        new_step = altered_step;\n      }\n\n      if (new_step > 2) {\n        ls.set(this.ls_prefix + \"step\", new_step);\n      }\n\n      this.setState({step: new_step});\n      this.stepChanged(new_step);\n    }\n  }\n\n  stepChanged = (step) => {\n    if (step === this.steps.FINISH) {\n      this.data.end_time = new Date().toString();\n      this.data.trials.forEach(t => {\n        t.id = this.data.id;\n        t.session_number = this.data.session_number;\n        t.start_time = this.data.start_time;\n        t.end_time = this.data.end_time;\n        if (this.data.session_number === 1) {\n          t.age = this.data.age;\n          t.gender = this.data.gender;\n          t.musical_performance_years = this.data.musical_performance_years;\n          t.musical_theory_years = this.data.musical_theory_years;\n          t.absolute_hearing = this.data.absolute_hearing;\n          t.is_musician = this.data.is_musician;\n          t.native_language = this.data.native_language;\n          t.musical_activity = this.data.musical_activity;\n          t.headphones = this.data.headphones;\n          t.computer = this.data.computer;\n          t.additional_devices = this.data.additional_devices;\n          t.location_details = this.data.location_details;\n        }\n      });\n\n      console.log(\"Saving data...\");\n      console.log(this.data.trials);\n      \n      const that = this;\n      gs.write(this.conn, this.data.id, this.data.trials)\n        .then(res => { \n          that.setState({done_saving: true});\n          writeSessionEvent(this.conn, this.data, SessionEvent.SESSION_END);\n        })\n        .catch(this.dataSaveError);\n    }\n  }\n\n  check_for_subject_sheet = () => {\n    return does_user_sheet_exists(this.conn, this.data.id)\n      .then(sheet_exists => {\n        if (sheet_exists) {\n          return true;\n        }\n        else {\n          this.setState({error: \"גיליון עבור נבדק \" + this.data.id + \" לא קיים במערכת.\",\n                         loading: false});\n          return false;\n        }\n      })\n      .catch(err => {\n        this.setState({error: \"לא ניתן להתחבר. בדקו את חיבור האינטרנט ונסו שוב. \" + err});\n      });\n  }\n\n  handleLogin() {\n    this.setState({loading: true});\n\n    // first look for the subject id's sheet.\n    this.check_for_subject_sheet()\n      .then(found_sheet => {\n        if (found_sheet) {\n          // then read the subject entry in the Subjects sheet.\n          read_subject_data(this.conn, this.data.id)\n            .then(subject_data => {\n              if (subject_data === null) {\n                this.setState({error: \"לא קיימים פרטים עבור נבדק \" + this.data.id + \" במערכת.\", \n                               loading: false});\n                return;\n              }\n\n              this.data.first_instrument = str_to_instrument(subject_data.first_instrument);\n              this.data.first_key = music_key_to_idx[subject_data.first_key];\n              \n              if (this.data.first_instrument === null || \n                  this.data.first_key === undefined) {\n                this.setState({error: \"התרחשה שגיאה בעת קריאת נתונים עבור נבדק \" + this.data.id + \".\",\n                               loading: false});\n                return;\n              }\n\n              // finally read the session sheet and look for the last entry for this subject\n              readSessionData(this.conn)\n                .then(sessions => {\n                  const previous_sessions = sessions.filter(e => e.id === this.data.id);\n                  if (previous_sessions.length === 0) {\n                    // First session. Not continued!\n                    this.startNewSession(1);\n                  } \n                  else {\n                    // Not first session or continued session.\n                    const last_session = previous_sessions[previous_sessions.length-1];\n                    const last_session_number = parseInt(last_session.number);\n                    if (last_session.event !== SessionEvent.SESSION_END) {\n                      // Continue session\n                      this.continueSession(last_session_number);\n                    }\n                    else {\n                      // Last session ended. \n                      if (last_session_number === 2) {\n                        this.setState({error: \"נבדק \" + this.data.id + \" סיים את הניסוי.\",\n                                       loading: false});\n                      }\n                      else {\n                        // Second session\n                        this.startNewSession(2);\n                      }\n                    }\n                  }\n                });              \n            });\n        }\n      });\n  }\n\n  startNewSession(number) {\n    console.log(\"start new session: \" + number);\n    this.data.session_number = number;\n    writeSessionEvent(this.conn, this.data, SessionEvent.SESSION_START);\n    this.setState({loading: false});\n\n    this.data.cur_instrument = (number === 1 ? \n                                this.data.first_instrument :\n                                other_instrument(this.data.first_instrument));\n\n    console.log(\"Starting new session. Clearing local storage\");\n    ls.clear();\n    ls.set(\"data\", this.data);\n  }\n\n  continueSession(number) {\n    console.log(\"continue session: \" + number);\n    // try to recover from local storage\n    const cont_data = ls.get(\"data\");\n\n    if (cont_data && cont_data.id === this.data.id) {\n      console.log(\"Loading from local storage...\");\n      \n      this.data = cont_data;\n      writeSessionEvent(this.conn, this.data, SessionEvent.SESSION_CONTINUED);\n      this.setState({loading: false});\n      \n      const cont_step = ls.get(this.ls_prefix + \"step\");\n\n      if (cont_step) {\n        this.setStep(cont_step);      \n      }\n    }\n    else {\n      this.startNewSession(number);\n    }\n  }\n\n  dataSaveError(response) {\n    alert(\"Error while saving data: \" + response);\n  }\n\n  componentDidMount() {\n    this.data.start_time = new Date().toString();\n  }\n\n  render() {\n    const { step, loading, error } = this.state;\n\n    if (error) {\n      return <ErrorScreen error={this.state.error} />;\n    } \n    else if (loading) {\n      return <LoadingScreen />;\n    } \n    else {\n      switch(step) {\n      case this.steps.LOGIN: \n        return <LoginScreen next={this.nextStep} data={this.data} key={step} />;\n      case this.steps.INTRO:\n        return <InfoScreen next={this.nextStep} info={intro_texts[this.data.session_number-1]} key={step} />;\n      case this.steps.FORM:\n        return <FormScreen next={this.nextStep} data={this.data} key={step} />;\n      case this.steps.EXPERIMENT1:\n        return <FirstExperiment data={this.data} next={this.nextStep} key={step} />;\n      case this.steps.EXPERIMENT2:\n        return <SecondExperiment data={this.data} next={this.nextStep} key={step} />;\n      case this.steps.FEEDBACK:\n        return <FeedbackScreen next={this.nextStep} data={this.data} key={step} />;\n      case this.steps.FINISH:\n        return <FinishScreen done_saving={this.state.done_saving} key={step} />;\n      default:\n        return null;\n      }\n    }\n  }\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n//import 'bootstrap/dist/css/bootstrap.min.css';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}